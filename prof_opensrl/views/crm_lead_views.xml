<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <record id="crm_lead_form_admin_fields" model="ir.ui.view">
    <field name="name">crm.lead.form.admin.fields</field>
    <field name="model">crm.lead</field>
    <field name="inherit_id" ref="crm.crm_lead_view_form"/>
    <field name="arch" type="xml">
      <xpath expr="//field[@name='partner_id']" position="attributes">
        <attribute name="groups">sales_team.group_sale_manager</attribute>
      </xpath>
      <xpath expr="//field[@name='expected_revenue']" position="attributes">
        <attribute name="groups">sales_team.group_sale_manager</attribute>
      </xpath>
      <xpath expr="//field[@name='probability']" position="attributes">
        <attribute name="groups">sales_team.group_sale_manager</attribute>
      </xpath>
      <xpath expr="//field[@name='user_id']" position="attributes">
        <attribute name="groups">sales_team.group_sale_manager</attribute>
      </xpath>
    </field>
  </record>

  <record id="crm_lead_form_deadline_label" model="ir.ui.view">
    <field name="name">crm.lead.form.deadline.label</field>
    <field name="model">crm.lead</field>
    <field name="inherit_id" ref="crm.crm_lead_view_form"/>
    <field name="arch" type="xml">
      <xpath expr="//sheet" position="inside">
        <group string="Cliente">
          <field name="becomes_customer"/>
          <field name="customer_image" widget="image" class="oe_avatar"/>
        </group>
      </xpath>
      <xpath expr="//field[@name='date_deadline']" position="attributes">
        <attribute name="string">Data visita prevista</attribute>
      </xpath>
    </field>
  </record>

  <record id="crm_lead_kanban_show_address" model="ir.ui.view">
    <field name="name">crm.lead.kanban.show.address</field>
    <field name="model">crm.lead</field>
    <field name="inherit_id" ref="crm.crm_case_kanban_view_leads"/>
    <field name="arch" type="xml">
    <xpath expr="//kanban/templates/t[@t-name='card']//field[@name='partner_id']" position="replace">
      <div class="o_kanban_address text-truncate">
        <t t-if="record.partner_name and record.partner_name.raw_value">

        </t>
        <aside>

          <field name="customer_image" widget="image" alt="negozio" options="{'img_class': 'w-100 object-fit-contain'}" invisible="not customer_image"/>


       </aside>
        <!-- IMPORTANTE: dichiara il campo perché venga letto nel record.* -->

         <t t-if="record.street and record.street.raw_value">
          <field name="street"/>
        </t>
        <div> <t t-if="(record.zip and record.zip.raw_value) or (record.city and record.city.raw_value)">
          <span><field name="zip"/> <field name="city"/></span>
        <t t-if="record.state_id and record.state_id.raw_value">
          <field name="state_id"/>
        </t>
        </t></div>




        <t t-if="record.phone and record.phone.raw_value">
          <field name="phone" widget="phone"/>
        </t>

        <t t-if="record.mobile and record.mobile.raw_value">
          <field name="mobile" widget="phone"/>
        </t>

        <t t-if="record.date_deadline and record.date_deadline.raw_value">
          <field name="date_deadline" widget="date" string="Data chiusura prevista"/>
        </t>

        <t t-if="record.becomes_customer and record.becomes_customer.raw_value">
          <field name="becomes_customer" />
        </t>


      </div>
    </xpath>

    <xpath expr="//kanban/templates/t[@t-name='card']//field[@name='name']" position="replace">
  <field class="fw-bold fs-5" name="partner_name"/>
</xpath>


    </field>
  </record>




  <record id="crm_lead_search_add_state_country" model="ir.ui.view">
    <field name="name">crm.lead.search.add.state.country</field>
    <field name="model">crm.lead</field>
    <field name="inherit_id" ref="crm.view_crm_case_opportunities_filter"/>
    <field name="arch" type="xml">
      <!-- Restrizione dei campi di ricerca visibili solo al manager vendite -->

      <xpath expr="//field[@name='tag_ids']" position="attributes">
        <attribute name="groups">sales_team.group_sale_manager</attribute>
        </xpath>

     <xpath expr="//field[@name='user_id']" position="attributes">
        <attribute name="groups">sales_team.group_sale_manager</attribute>
        </xpath>

     <xpath expr="//field[@name='stage_id']" position="attributes">
        <attribute name="groups">sales_team.group_sale_manager</attribute>
        </xpath>

     <xpath expr="//field[@name='activity_state']" position="attributes">
        <attribute name="groups">sales_team.group_sale_manager</attribute>
        </xpath>

<xpath expr="//field[@name='lead_properties']" position="attributes">
        <attribute name="groups">sales_team.group_sale_manager</attribute>
    </xpath>



      <xpath expr="//field[@name='team_id']" position="attributes">
        <attribute name="groups">sales_team.group_sale_manager</attribute>
      </xpath>
      <xpath expr="//field[@name='user_id']" position="attributes">
        <attribute name="groups">sales_team.group_sale_manager</attribute>
      </xpath>
      <xpath expr="//field[@name='country_id']" position="attributes">
        <attribute name="groups">sales_team.group_sale_manager</attribute>
      </xpath>
      <!-- Il campo Proprietà può essere esposto come property_id o company_id a seconda della versione -->
      <xpath expr="//field[@name='lead_properties'] | //field[@name='activity_state']" position="attributes">
        <attribute name="groups">sales_team.group_sale_manager</attribute>
      </xpath>

      <xpath expr="//search" position="inside">
        <!-- Campo Provincia disponibile a tutti per la ricerca -->
        <field name="state_id" string="provincia"/>
        <!-- Campo indirizzo sempre disponibile per la ricerca -->
        <field name="street" string="Indirizzo"/>
      </xpath>
    </field>
  </record>
</odoo>
